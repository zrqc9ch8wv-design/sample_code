<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‡ªå‹•ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼ï¼ˆå®Œå…¨ç‰ˆï¼‰</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background: #000;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
        }

        .slideshow-container {
            position: relative;
            width: 100%;
            height: 100%;
            background: #000;
        }

        .slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 1s ease-in-out;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #000;
        }

        .slide.active {
            opacity: 1;
            z-index: 2;
        }

        .slide.fade-out {
            opacity: 0;
            z-index: 1;
        }

        .slide img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .slide iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px 20px;
            border-radius: 10px;
            display: flex;
            gap: 10px;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }

        body:hover .controls {
            opacity: 1;
        }

        .controls button {
            background: #4a9fd8;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .controls button:hover {
            background: #3d8ac4;
            transform: scale(1.05);
        }

        .controls .info {
            color: white;
            font-size: 14px;
            margin-right: 10px;
        }

        .fullscreen-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(74, 159, 216, 0.8);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            z-index: 1000;
            opacity: 0;
        }

        body:hover .fullscreen-btn {
            opacity: 1;
        }

        .fullscreen-btn:hover {
            background: rgba(61, 138, 196, 0.9);
            transform: scale(1.05);
        }

        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: white;
        }

        .loading.hidden {
            display: none;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 6px solid rgba(255, 255, 255, 0.2);
            border-top-color: #4a9fd8;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 20px;
            font-size: 18px;
            color: #ccc;
        }

        .settings-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            z-index: 10000;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .settings-panel.hidden {
            display: none;
        }

        .settings-panel h2 {
            margin-bottom: 30px;
            color: #2c3e50;
            font-size: 28px;
        }

        .settings-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #ddd;
        }

        .tab-button {
            padding: 12px 24px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #666;
            transition: all 0.3s ease;
        }

        .tab-button.active {
            color: #4a9fd8;
            border-bottom-color: #4a9fd8;
        }

        .tab-button:hover {
            color: #3d8ac4;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .file-list {
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .file-item {
            padding: 15px;
            margin-bottom: 10px;
            background: #f5f5f5;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            cursor: move;
            transition: all 0.3s ease;
        }

        .file-item:hover {
            background: #ebebeb;
            border-color: #4a9fd8;
        }

        .file-item.dragging {
            opacity: 0.5;
            border-color: #4a9fd8;
            background: #e3f2fd;
        }

        .file-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .file-item-name {
            font-weight: 600;
            color: #2c3e50;
            flex: 1;
        }

        .file-item-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .duration-input {
            width: 80px;
            padding: 5px 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            text-align: center;
        }

        .duration-label {
            font-size: 14px;
            color: #666;
        }

        .delete-file-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 5px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
        }

        .delete-file-btn:hover {
            background: #c0392b;
        }

        .drag-handle {
            color: #999;
            font-size: 20px;
            cursor: move;
            margin-right: 10px;
        }

        .settings-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 30px;
        }

        .settings-actions button {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #4a9fd8;
            color: white;
        }

        .btn-primary:hover {
            background: #3d8ac4;
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .storage-info {
            background: #e8f4fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #2c3e50;
            border-left: 4px solid #4a9fd8;
        }

        .saved-files-count {
            background: #d4edda;
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            color: #155724;
            font-weight: 600;
        }

        .add-file-btn {
            background: #4a9fd8;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 20px;
            width: 100%;
        }

        .add-file-btn:hover {
            background: #3d8ac4;
        }

        input[type="file"] {
            display: none;
        }

        .schedule-section {
            margin-bottom: 30px;
        }

        .schedule-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 20px;
        }

        .schedule-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .schedule-toggle input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .schedule-toggle label {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            cursor: pointer;
        }

        .schedule-content {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px solid #ddd;
        }

        .schedule-content.disabled {
            opacity: 0.5;
            pointer-events: none;
        }

        .time-input-group {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .time-input-field {
            flex: 1;
        }

        .time-input-field label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .time-input-field input[type="time"] {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        .days-selector {
            margin-top: 20px;
        }

        .days-selector label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #2c3e50;
        }

        .days-checkboxes {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .day-checkbox {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 8px 15px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .day-checkbox:hover {
            border-color: #4a9fd8;
            background: #e3f2fd;
        }

        .day-checkbox input {
            cursor: pointer;
        }

        .reload-section {
            margin-top: 20px;
            padding: 20px;
            background: #fff3cd;
            border-radius: 8px;
            border-left: 4px solid #ffc107;
        }

        .reload-section h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        .reload-section p {
            color: #856404;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .reload-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .reload-toggle input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .reload-toggle label {
            font-weight: 600;
            color: #856404;
            cursor: pointer;
        }

        .status-bar {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 15px;
            border-radius: 8px;
            color: white;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }

        body:hover .status-bar {
            opacity: 1;
        }

        .status-active {
            color: #4caf50;
        }

        .status-inactive {
            color: #f44336;
        }
    </style>
</head>
<body>
    <div class="loading" id="loading">
        <div class="loading-spinner"></div>
        <div class="loading-text">ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼ã‚’æº–å‚™ä¸­...</div>
    </div>

    <div class="settings-panel" id="settingsPanel">
        <h2>âš™ï¸ ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼è¨­å®š</h2>
        
        <div class="settings-tabs">
            <button class="tab-button active" onclick="switchTab('files')">ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†</button>
            <button class="tab-button" onclick="switchTab('schedule')">â° ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</button>
            <button class="tab-button" onclick="switchTab('advanced')">ğŸ”§ è©³ç´°è¨­å®š</button>
        </div>

        <!-- ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ã‚¿ãƒ– -->
        <div class="tab-content active" id="filesTab">
            <div class="storage-info">
                ğŸ’¾ <strong>è‡ªå‹•ä¿å­˜æ©Ÿèƒ½:</strong> è¨­å®šã¯ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ã•ã‚Œã€æ¬¡å›èµ·å‹•æ™‚ã«è‡ªå‹•ã§èª­ã¿è¾¼ã¾ã‚Œã¾ã™ã€‚
            </div>

            <div class="saved-files-count" id="savedFilesCount" style="display: none;">
                âœ… ä¿å­˜æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«: <span id="fileCount">0</span>å€‹
            </div>

            <label for="fileInput" class="add-file-btn">
                ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ ï¼ˆç”»åƒãƒ»PDFï¼‰
            </label>
            <input type="file" id="fileInput" multiple accept="image/*,.pdf">

            <p style="margin-bottom: 10px; color: #666; font-size: 14px;">
                ğŸ’¡ ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã§é †ç•ªã‚’å¤‰æ›´ã§ãã¾ã™
            </p>

            <div class="file-list" id="fileList"></div>
        </div>

        <!-- ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¿ãƒ– -->
        <div class="tab-content" id="scheduleTab">
            <div class="schedule-section">
                <h3>â° è‡ªå‹•èµ·å‹•ãƒ»çµ‚äº†ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</h3>
                
                <div class="schedule-toggle">
                    <input type="checkbox" id="scheduleEnabled" onchange="toggleSchedule()">
                    <label for="scheduleEnabled">ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æ©Ÿèƒ½ã‚’æœ‰åŠ¹ã«ã™ã‚‹</label>
                </div>

                <div class="schedule-content disabled" id="scheduleContent">
                    <div class="time-input-group">
                        <div class="time-input-field">
                            <label for="startTime">ğŸŒ… é–‹å§‹æ™‚åˆ»</label>
                            <input type="time" id="startTime" value="08:00">
                        </div>
                        <div class="time-input-field">
                            <label for="endTime">ğŸŒ† çµ‚äº†æ™‚åˆ»</label>
                            <input type="time" id="endTime" value="18:00">
                        </div>
                    </div>

                    <div class="days-selector">
                        <label>ğŸ“… å®Ÿè¡Œã™ã‚‹æ›œæ—¥ã‚’é¸æŠ</label>
                        <div class="days-checkboxes">
                            <div class="day-checkbox">
                                <input type="checkbox" id="day0" checked>
                                <label for="day0">æ—¥</label>
                            </div>
                            <div class="day-checkbox">
                                <input type="checkbox" id="day1" checked>
                                <label for="day1">æœˆ</label>
                            </div>
                            <div class="day-checkbox">
                                <input type="checkbox" id="day2" checked>
                                <label for="day2">ç«</label>
                            </div>
                            <div class="day-checkbox">
                                <input type="checkbox" id="day3" checked>
                                <label for="day3">æ°´</label>
                            </div>
                            <div class="day-checkbox">
                                <input type="checkbox" id="day4" checked>
                                <label for="day4">æœ¨</label>
                            </div>
                            <div class="day-checkbox">
                                <input type="checkbox" id="day5" checked>
                                <label for="day5">é‡‘</label>
                            </div>
                            <div class="day-checkbox">
                                <input type="checkbox" id="day6" checked>
                                <label for="day6">åœŸ</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- è©³ç´°è¨­å®šã‚¿ãƒ– -->
        <div class="tab-content" id="advancedTab">
            <div class="reload-section">
                <h4>ğŸ”„ è‡ªå‹•ãƒªãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½</h4>
                <p>24æ™‚é–“é€£ç¶šç¨¼åƒæ™‚ã®ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ã‚’é˜²ããŸã‚ã€å®šæœŸçš„ã«ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚</p>
                
                <div class="reload-toggle">
                    <input type="checkbox" id="autoReloadEnabled" checked>
                    <label for="autoReloadEnabled">è‡ªå‹•ãƒªãƒ­ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹ã«ã™ã‚‹ï¼ˆ6æ™‚é–“ã”ã¨ï¼‰</label>
                </div>
            </div>

            <div style="margin-top: 30px;">
                <button class="btn-danger" onclick="clearSavedData()" id="clearBtn" style="width: 100%;">
                    ğŸ—‘ï¸ ã™ã¹ã¦ã®ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤
                </button>
            </div>
        </div>

        <div class="settings-actions">
            <button class="btn-secondary" onclick="closeSettings()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            <button class="btn-primary" onclick="saveAndStartSlideshow()">ğŸ’¾ ä¿å­˜ã—ã¦é–‹å§‹</button>
        </div>
    </div>

    <div class="status-bar" id="statusBar">
        <span id="statusText">æº–å‚™ä¸­...</span>
    </div>

    <button class="fullscreen-btn" id="fullscreenBtn" onclick="toggleFullscreen()">
        ğŸ–¥ï¸ ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³
    </button>

    <div class="slideshow-container" id="slideshowContainer"></div>

    <div class="controls">
        <span class="info" id="slideInfo">-</span>
        <button onclick="previousSlide()">â®ï¸ å‰ã¸</button>
        <button onclick="togglePause()" id="pauseBtn">â¸ï¸ ä¸€æ™‚åœæ­¢</button>
        <button onclick="nextSlide()">æ¬¡ã¸ â­ï¸</button>
        <button onclick="openSettings()">âš™ï¸ è¨­å®š</button>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let slides = [];
        let currentSlideIndex = 0;
        let slideInterval = null;
        let isPaused = false;
        let currentSlideTimer = null;
        let scheduleCheckInterval = null;
        let autoReloadInterval = null;

        // LocalStorageã‚­ãƒ¼
        const STORAGE_KEY_FILES = 'slideshow_files_v2';
        const STORAGE_KEY_SCHEDULE = 'slideshow_schedule';
        const STORAGE_KEY_RELOAD = 'slideshow_reload';

        // åˆæœŸåŒ–
        window.addEventListener('load', function() {
            document.getElementById('loading').classList.add('hidden');
            loadSavedData();
            initDragAndDrop();
            initAutoReload();
        });

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function switchTab(tabName) {
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
        }

        // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æ©Ÿèƒ½ã®æœ‰åŠ¹/ç„¡åŠ¹åˆ‡ã‚Šæ›¿ãˆ
        function toggleSchedule() {
            const enabled = document.getElementById('scheduleEnabled').checked;
            const content = document.getElementById('scheduleContent');
            
            if (enabled) {
                content.classList.remove('disabled');
            } else {
                content.classList.add('disabled');
            }
        }

        // ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
        function loadSavedData() {
            try {
                // ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‡ãƒ¼ã‚¿
                const savedFiles = localStorage.getItem(STORAGE_KEY_FILES);
                if (savedFiles) {
                    slides = JSON.parse(savedFiles);
                    updateFileList();
                    updateSavedFilesCount();
                }

                // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®š
                const savedSchedule = localStorage.getItem(STORAGE_KEY_SCHEDULE);
                if (savedSchedule) {
                    const schedule = JSON.parse(savedSchedule);
                    document.getElementById('scheduleEnabled').checked = schedule.enabled;
                    document.getElementById('startTime').value = schedule.startTime;
                    document.getElementById('endTime').value = schedule.endTime;
                    
                    schedule.days.forEach((checked, index) => {
                        document.getElementById('day' + index).checked = checked;
                    });
                    
                    toggleSchedule();
                }

                // è‡ªå‹•ãƒªãƒ­ãƒ¼ãƒ‰è¨­å®š
                const savedReload = localStorage.getItem(STORAGE_KEY_RELOAD);
                if (savedReload) {
                    document.getElementById('autoReloadEnabled').checked = JSON.parse(savedReload);
                }

                // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯é–‹å§‹
                startScheduleCheck();

                // ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹å ´åˆã¯è‡ªå‹•èµ·å‹•
                if (slides.length > 0 && checkSchedule()) {
                    document.getElementById('settingsPanel').classList.add('hidden');
                    startSlideshow();
                } else if (slides.length > 0) {
                    document.getElementById('settingsPanel').classList.remove('hidden');
                    updateStatusBar(false);
                } else {
                    document.getElementById('settingsPanel').classList.remove('hidden');
                }

            } catch (e) {
                console.error('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', e);
                document.getElementById('settingsPanel').classList.remove('hidden');
            }
        }

        // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯
        function checkSchedule() {
            const enabled = document.getElementById('scheduleEnabled').checked;
            if (!enabled) return true;

            const now = new Date();
            const currentTime = now.getHours() * 60 + now.getMinutes();
            const currentDay = now.getDay();

            const startTime = document.getElementById('startTime').value.split(':');
            const endTime = document.getElementById('endTime').value.split(':');
            
            const startMinutes = parseInt(startTime[0]) * 60 + parseInt(startTime[1]);
            const endMinutes = parseInt(endTime[0]) * 60 + parseInt(endTime[1]);

            const dayEnabled = document.getElementById('day' + currentDay).checked;

            const isInTimeRange = currentTime >= startMinutes && currentTime < endMinutes;
            
            return dayEnabled && isInTimeRange;
        }

        // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯ã‚’å®šæœŸå®Ÿè¡Œ
        function startScheduleCheck() {
            if (scheduleCheckInterval) {
                clearInterval(scheduleCheckInterval);
            }

            scheduleCheckInterval = setInterval(() => {
                const shouldRun = checkSchedule();
                
                if (shouldRun && !slideInterval && slides.length > 0) {
                    // é–‹å§‹æ™‚åˆ»ã«ãªã£ãŸ
                    console.log('ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«é–‹å§‹');
                    document.getElementById('settingsPanel').classList.add('hidden');
                    startSlideshow();
                } else if (!shouldRun && slideInterval) {
                    // çµ‚äº†æ™‚åˆ»ã«ãªã£ãŸ
                    console.log('ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«çµ‚äº†');
                    stopSlideshow();
                }

                updateStatusBar(shouldRun);
            }, 30000); // 30ç§’ã”ã¨ã«ãƒã‚§ãƒƒã‚¯
        }

        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼æ›´æ–°
        function updateStatusBar(isActive) {
            const statusText = document.getElementById('statusText');
            const enabled = document.getElementById('scheduleEnabled').checked;

            if (!enabled) {
                statusText.innerHTML = 'âšª ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«: <span style="color: #999;">ç„¡åŠ¹</span>';
            } else if (isActive) {
                statusText.innerHTML = 'ğŸŸ¢ ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«: <span class="status-active">ç¨¼åƒä¸­</span>';
            } else {
                statusText.innerHTML = 'ğŸ”´ ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«: <span class="status-inactive">å¾…æ©Ÿä¸­</span>';
            }
        }

        // ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼åœæ­¢
        function stopSlideshow() {
            stopAutoPlay();
            document.getElementById('slideshowContainer').innerHTML = '';
            updateStatusBar(false);
        }

        // è‡ªå‹•ãƒªãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½
        function initAutoReload() {
            const enabled = document.getElementById('autoReloadEnabled').checked;
            
            if (autoReloadInterval) {
                clearInterval(autoReloadInterval);
            }

            if (enabled) {
                // 6æ™‚é–“ã”ã¨ã«ãƒªãƒ­ãƒ¼ãƒ‰
                autoReloadInterval = setInterval(() => {
                    console.log('è‡ªå‹•ãƒªãƒ­ãƒ¼ãƒ‰å®Ÿè¡Œ');
                    location.reload();
                }, 6 * 60 * 60 * 1000);
            }
        }

        // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            
            files.forEach(file => {
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    slides.push({
                        data: event.target.result,
                        name: file.name,
                        type: file.type.startsWith('image/') ? 'image' : 'pdf',
                        duration: 5 // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ5ç§’
                    });

                    updateFileList();
                    updateSavedFilesCount();
                };

                reader.readAsDataURL(file);
            });

            // å…¥åŠ›ã‚’ãƒªã‚»ãƒƒãƒˆï¼ˆåŒã˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å†åº¦é¸æŠã§ãã‚‹ã‚ˆã†ã«ï¼‰
            e.target.value = '';
        });

        // ãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆã‚’æ›´æ–°
        function updateFileList() {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '';

            slides.forEach((slide, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.draggable = true;
                fileItem.dataset.index = index;

                fileItem.innerHTML = `
                    <div class="file-item-header">
                        <span class="drag-handle">â˜°</span>
                        <span class="file-item-name">ğŸ“„ ${slide.name}</span>
                        <div class="file-item-controls">
                            <input type="number" class="duration-input" value="${slide.duration}" min="1" max="300" 
                                onchange="updateDuration(${index}, this.value)">
                            <span class="duration-label">ç§’</span>
                            <button class="delete-file-btn" onclick="removeFile(${index})">å‰Šé™¤</button>
                        </div>
                    </div>
                `;

                fileList.appendChild(fileItem);
            });

            // ãƒ‰ãƒ©ãƒƒã‚°ã‚¤ãƒ™ãƒ³ãƒˆã‚’å†è¨­å®š
            initDragAndDrop();
        }

        // è¡¨ç¤ºæ™‚é–“ã‚’æ›´æ–°
        function updateDuration(index, value) {
            slides[index].duration = parseInt(value);
        }

        // ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤
        function removeFile(index) {
            slides.splice(index, 1);
            updateFileList();
            updateSavedFilesCount();
        }

        // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—åˆæœŸåŒ–
        function initDragAndDrop() {
            let draggedElement = null;
            let draggedIndex = null;

            document.querySelectorAll('.file-item').forEach(item => {
                item.addEventListener('dragstart', function(e) {
                    draggedElement = this;
                    draggedIndex = parseInt(this.dataset.index);
                    this.classList.add('dragging');
                });

                item.addEventListener('dragend', function() {
                    this.classList.remove('dragging');
                });

                item.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    const afterElement = getDragAfterElement(document.getElementById('fileList'), e.clientY);
                    const draggable = document.querySelector('.dragging');
                    
                    if (afterElement == null) {
                        document.getElementById('fileList').appendChild(draggable);
                    } else {
                        document.getElementById('fileList').insertBefore(draggable, afterElement);
                    }
                });

                item.addEventListener('drop', function(e) {
                    e.preventDefault();
                    const dropIndex = parseInt(this.dataset.index);
                    
                    if (draggedIndex !== dropIndex) {
                        // é…åˆ—ã®é †ç•ªã‚’å…¥ã‚Œæ›¿ãˆ
                        const [removed] = slides.splice(draggedIndex, 1);
                        slides.splice(dropIndex, 0, removed);
                        
                        updateFileList();
                    }
                });
            });
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.file-item:not(.dragging)')];

            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;

                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        // ä¿å­˜æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«æ•°ã‚’æ›´æ–°
        function updateSavedFilesCount() {
            const count = slides.length;
            if (count > 0) {
                document.getElementById('savedFilesCount').style.display = 'block';
                document.getElementById('fileCount').textContent = count;
            } else {
                document.getElementById('savedFilesCount').style.display = 'none';
            }
        }

        // ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤
        function clearSavedData() {
            if (!confirm('ã™ã¹ã¦ã®è¨­å®šã¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                return;
            }

            localStorage.removeItem(STORAGE_KEY_FILES);
            localStorage.removeItem(STORAGE_KEY_SCHEDULE);
            localStorage.removeItem(STORAGE_KEY_RELOAD);
            
            slides = [];
            updateFileList();
            updateSavedFilesCount();
            
            alert('ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚');
        }

        // ä¿å­˜ã—ã¦ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼é–‹å§‹
        function saveAndStartSlideshow() {
            if (slides.length === 0) {
                alert('ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ ã—ã¦ãã ã•ã„');
                return;
            }

            try {
                // ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
                localStorage.setItem(STORAGE_KEY_FILES, JSON.stringify(slides));

                // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®šã‚’ä¿å­˜
                const schedule = {
                    enabled: document.getElementById('scheduleEnabled').checked,
                    startTime: document.getElementById('startTime').value,
                    endTime: document.getElementById('endTime').value,
                    days: [0, 1, 2, 3, 4, 5, 6].map(i => document.getElementById('day' + i).checked)
                };
                localStorage.setItem(STORAGE_KEY_SCHEDULE, JSON.stringify(schedule));

                // è‡ªå‹•ãƒªãƒ­ãƒ¼ãƒ‰è¨­å®šã‚’ä¿å­˜
                const autoReload = document.getElementById('autoReloadEnabled').checked;
                localStorage.setItem(STORAGE_KEY_RELOAD, JSON.stringify(autoReload));

                console.log('è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ');

                // è‡ªå‹•ãƒªãƒ­ãƒ¼ãƒ‰é–‹å§‹
                initAutoReload();

            } catch (e) {
                console.error('ä¿å­˜ã‚¨ãƒ©ãƒ¼:', e);
                alert('ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãã™ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚');
                return;
            }

            // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯
            if (!checkSchedule()) {
                alert('ç¾åœ¨ã¯ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æ™‚é–“å¤–ã§ã™ã€‚è¨­å®šã—ãŸæ™‚é–“ã«ãªã‚‹ã¨è‡ªå‹•ã§é–‹å§‹ã—ã¾ã™ã€‚');
                document.getElementById('settingsPanel').classList.add('hidden');
                startScheduleCheck();
                updateStatusBar(false);
                return;
            }

            document.getElementById('settingsPanel').classList.add('hidden');
            startSlideshow();
        }

        // ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼é–‹å§‹
        function startSlideshow() {
            if (slides.length === 0) return;

            renderSlides();
            showSlide(0);
            startAutoPlay();
            updateStatusBar(true);
        }

        // ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
        function renderSlides() {
            const container = document.getElementById('slideshowContainer');
            container.innerHTML = '';

            slides.forEach((slide, index) => {
                const slideDiv = document.createElement('div');
                slideDiv.className = 'slide';
                slideDiv.dataset.index = index;

                if (slide.type === 'image') {
                    const img = document.createElement('img');
                    img.src = slide.data;
                    slideDiv.appendChild(img);
                } else if (slide.type === 'pdf') {
                    const iframe = document.createElement('iframe');
                    iframe.src = slide.data;
                    slideDiv.appendChild(iframe);
                }

                container.appendChild(slideDiv);
            });
        }

        // ã‚¹ãƒ©ã‚¤ãƒ‰è¡¨ç¤ºï¼ˆå€‹åˆ¥ã‚¿ã‚¤ãƒãƒ¼å¯¾å¿œï¼‰
        function showSlide(index) {
            const allSlides = document.querySelectorAll('.slide');
            
            allSlides.forEach(slide => {
                slide.classList.remove('active');
                slide.classList.add('fade-out');
            });

            if (allSlides[index]) {
                allSlides[index].classList.remove('fade-out');
                allSlides[index].classList.add('active');
            }

            currentSlideIndex = index;
            updateSlideInfo();

            // ç¾åœ¨ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã®è¡¨ç¤ºæ™‚é–“ã‚’å–å¾—
            const currentDuration = slides[index].duration * 1000;

            // å€‹åˆ¥ã‚¿ã‚¤ãƒãƒ¼ã‚’è¨­å®š
            if (currentSlideTimer) {
                clearTimeout(currentSlideTimer);
            }

            currentSlideTimer = setTimeout(() => {
                if (!isPaused) {
                    nextSlide();
                }
            }, currentDuration);
        }

        // ã‚¹ãƒ©ã‚¤ãƒ‰æƒ…å ±æ›´æ–°
        function updateSlideInfo() {
            const info = document.getElementById('slideInfo');
            info.textContent = `${currentSlideIndex + 1} / ${slides.length} (${slides[currentSlideIndex].duration}ç§’)`;
        }

        // è‡ªå‹•å†ç”Ÿé–‹å§‹
        function startAutoPlay() {
            // å€‹åˆ¥ã‚¿ã‚¤ãƒãƒ¼æ–¹å¼ãªã®ã§ã€ã“ã“ã§ã¯ä½•ã‚‚ã—ãªã„
            // showSlide()å†…ã§å„ã‚¹ãƒ©ã‚¤ãƒ‰ã”ã¨ã«ã‚¿ã‚¤ãƒãƒ¼ãŒè¨­å®šã•ã‚Œã‚‹
        }

        // è‡ªå‹•å†ç”Ÿåœæ­¢
        function stopAutoPlay() {
            if (currentSlideTimer) {
                clearTimeout(currentSlideTimer);
                currentSlideTimer = null;
            }
        }

        // æ¬¡ã®ã‚¹ãƒ©ã‚¤ãƒ‰
        function nextSlide() {
            currentSlideIndex = (currentSlideIndex + 1) % slides.length;
            showSlide(currentSlideIndex);
        }

        // å‰ã®ã‚¹ãƒ©ã‚¤ãƒ‰
        function previousSlide() {
            currentSlideIndex = (currentSlideIndex - 1 + slides.length) % slides.length;
            showSlide(currentSlideIndex);
        }

        // ä¸€æ™‚åœæ­¢/å†é–‹
        function togglePause() {
            isPaused = !isPaused;
            const btn = document.getElementById('pauseBtn');
            
            if (isPaused) {
                btn.textContent = 'â–¶ï¸ å†é–‹';
                stopAutoPlay();
            } else {
                btn.textContent = 'â¸ï¸ ä¸€æ™‚åœæ­¢';
                showSlide(currentSlideIndex); // ã‚¿ã‚¤ãƒãƒ¼å†é–‹
            }
        }

        // ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³åˆ‡ã‚Šæ›¿ãˆ
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
                document.getElementById('fullscreenBtn').textContent = 'ğŸ–¥ï¸ çµ‚äº†';
            } else {
                document.exitFullscreen();
                document.getElementById('fullscreenBtn').textContent = 'ğŸ–¥ï¸ ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³';
            }
        }

        // è¨­å®šã‚’é–‹ã
        function openSettings() {
            stopAutoPlay();
            document.getElementById('settingsPanel').classList.remove('hidden');
            updateSavedFilesCount();
        }

        // è¨­å®šã‚’é–‰ã˜ã‚‹
        function closeSettings() {
            document.getElementById('settingsPanel').classList.add('hidden');
            if (slides.length > 0 && checkSchedule()) {
                showSlide(currentSlideIndex);
            }
        }

        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('settingsPanel').classList.contains('hidden')) {
                switch(e.key) {
                    case 'ArrowRight':
                        nextSlide();
                        break;
                    case 'ArrowLeft':
                        previousSlide();
                        break;
                    case ' ':
                        togglePause();
                        e.preventDefault();
                        break;
                    case 'f':
                    case 'F':
                        toggleFullscreen();
                        break;
                    case 'Escape':
                        if (document.fullscreenElement) {
                            document.exitFullscreen();
                        }
                        break;
                }
            }
        });
    </script>
</body>
</html>
